#!/bin/sh
read -n 1 -p "Скрипт формирует новый код и его исполнение может привести к потере старых данных. Ты уверен, что хочешь запустить это (y/[a]): " AMSURE 
[ "$AMSURE" = "y" ] || exit
echo "" 1>&2

buildPath=$(dirname $(realpath $0))

cd $(realpath $buildPath/../../vendor/happymeal)

#build php, js classes & tests
#./happymeal xsd2code -s "../../school30/web/schemas" -o "../../school30" -vjm "School\\Port\\Adaptor\\Data" School

#build controller code
#./happymeal wadl2code -s "../../school30/web/schemas" -o "../../school30" -m "School\\Port\\Adaptor\\Data" School

cd $(realpath $buildPath)
#minify && uglify
java -jar ~/yuicompressor/yuicompressor-2.4.8.jar --type js ../web/js/school30.js > ../web/js/school30.min.js
chmod 755 ../web/js/school30.min.js
echo "minify js ...                   OK!"

find ../src/css -type f -name *.css | while read f; do
    fl=$(basename "$f")
    fn="${fl%.*}"
    java -jar ~/yuicompressor/yuicompressor-2.4.8.jar --type css -o ../web/css/"$fn".min.css $f
    cp -f $f ../web/css/"$fn".css
done
chmod 755 -R ../web/css
echo "minify css ...                   OK!"
