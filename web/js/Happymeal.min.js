(function(a){this.Happymeal={};var d=function(h){if(arguments.length==1){return d(h,this)}if(null==h||"object"!=typeof h){return h}var g,j;for(var e=1,f=arguments.length;e<f;e++){g=arguments[e];for(j in g){if(!Object.prototype.hasOwnProperty.call(h,j)){h[j]=g[j]}}}if(typeof h.initialize=="function"){h.initialize(h)}return h};var b=function(){if(typeof XMLHttpRequest!="undefined"){return new XMLHttpRequest()}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(f){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}return false};var c=function(f){if(window.ActiveXObject){var e;e=new ActiveXObject("Microsoft.XMLDOM");e.async=false;e.loadXML(f);return e}else{if(window.DOMParser){var g=new DOMParser();return g.parseFromString(f,"text/xml")}else{console.log("Загрузка XML не поддерживается браузером");return null}}};Happymeal.hashCode=function(g){var e;var f=0;if(g.length==0){return f}for(i=0;i<g.length;i++){e=g.charCodeAt(i);f=((f<<5)-f)+e;f=f&f}return f};Happymeal.preserve=function(h,k){var j=k.split("."),g=h,f,e;f=j.length;for(e=0;e<f;e++){if(typeof g[j[e]]=="undefined"){g[j[e]]={}}g=g[j[e]]}return g};Happymeal.Mediator=(function(){var f={};var g=function(l,k,j){if(!f[l]){f[l]=[]}f[l].push({context:j||this,callback:k});return this};var h=function(o){if(!f[o]){return false}var k=Array.prototype.slice.call(arguments,1);for(var m=0,j=f[o].length;m<j;m++){var n=f[o][m];n.callback.apply(n.context,k)}return this};var e=function(k){if(k&&k.length){for(var m=0,j=k.length;m<j;m++){if(f[k[m]]){delete f[k[m]]}}}else{f=[]}};return{toObject:function(j){j.clear=e;j.publish=h;j.subscribe=g;return j},clear:e,publish:h,subscribe:g}}());Happymeal.preserve(Happymeal,"Port.Adaptor.HTTP");Happymeal.Port.Adaptor.HTTP=(function(){var h=function(n){var l;if(n.method==="POST"&&n.accept==="application/xml"){l="<?xml version='1.0' encoding='utf-8'?>";l+=n.entity.toXmlStr()}else{if(n.method==="POST"){if(typeof n.entity.toJSON==="function"){l=JSON.stringify(n.entity.toJSON())}else{l=JSON.stringify(n.entity)}}}var m=b();m.open(n.method,n.url,true);m.setRequestHeader("Accept",n.accept||"application/json");if(n.content){m.setRequestHeader("Content-type",n.content)}if(n.override){m.setRequestHeader("X-HTTP-Method-Override",n.override)}m.onreadystatechange=function(){if(m.readyState==4){if(m.status==200){n.callback(m)}else{if(m.status==404){Happymeal.Mediator.publish("ErrorOccured",{message:m.responseText})}else{Happymeal.Mediator.publish("ErrorOccured",{message:m.responseText})}}}};m.send(l)};var f=function(l){l.method="GET";h(l)};var g=function(l){l.method="POST";h(l)};var k=function(l){l.method="POST";l.override="PUT";h(l)};var j=function(l){l.method="POST";l.override="PATCH";h(l)};var e=function(l){l.method="POST";l.override="DELETE";h(l)};return Happymeal.Mediator.toObject({get:f,post:g,put:k,patch:j,del:e})}());Happymeal.Locator=(function(){var f={};var e=function(g,h){if(!h&&typeof f[g]=="function"){return f[g]()}else{if(h){f[g]=h}}};return e}());Happymeal.preserve(Happymeal,"Port.Adaptor.Data.XML.Schema");Happymeal.Port.Adaptor.Data.XML.Schema.AnyComplexType={toJSON:function(){var l=this.getAll();this.JSON=this.JSON||{};var e=Object.keys(l).length;var h=function(n){if(n&&typeof n==="object"&&typeof n.toJSON!=="undefined"){return n.toJSON()}else{return n}};var m;for(m in l){if(l[m] instanceof Array){var k=[],f,j,g=l[m].length;for(f=0;f<g;f++){k.push(h(l[m][f]))}if(e===1){this.JSON=k}else{this.JSON[m]=k}}else{this.JSON[m]=h(l[m])}}return this.JSON},fromXmlStr:function(f,k){var e=true,j=sax.parser(e),g=this,h;j.onopentag=function(l){h=l.name;g.fromXmlParser(j,null,k)};j.write(f).close()}};Happymeal.Port.Adaptor.Data.XML.Schema.AnySimpleType={toJSON:function(){this.JSON={};this.JSON[this.ROOT]=this.get();return this.JSON},fromXmlStr:function(f,j){var e=true,h=sax.parser(e),g=this;h.onopentag=function(k){g.ROOT=k.name;g.fromXmlParser(h,null,j)};h.write(f).close()}};Happymeal.XMLView=(function(){var f={};var j={};var h=function(o,n){if(!o.documentElement){o=c(o)}if(!n.documentElement){n=c(n)}if(window.ActiveXObject){return o.transformNode(n)}else{if(window.XSLTProcessor){var l=new XSLTProcessor();l.importStylesheet(n);var m=l.transformToDocument(o);return m}else{Happymeal.Mediator.publish("ErrorOccured",{msg:"Преобразование XML не поддерживается браузером"});return null}}};var g=function(m){if(!f[this.template]){if(!j[this.template]){j[this.template]=[]}j[this.template].push({view:this,data:m})}else{var l=f[this.template];var n=document.getElementById(this.elementId);n.innerHTML=h(m,l).documentElement.innerHTML;this.bind(n,m)}};var e=function(){for(prop in this.events){this.subscribe(prop,this.events[prop])}if(!f[this.template]){var l=Happymeal.Port.Adaptor.HTTP.extend({});l.get({url:this.template,callback:function(m){f[this.url]=m.responseXML;if(j[this.url]){for(var n=0;n<j[this.url].length;n++){j[this.url][n].view.render(j[this.url][n].data)}j[this.url]=[]}}})}};var k=function(){};return Happymeal.Mediator.toObject({render:g,bind:k,initialize:e})}());Happymeal.HTMLView=(function(){var f={};var h={};var g=function(n){if(!f[this.template]){if(!h[this.template]){h[this.template]=[]}h[this.template].push({view:this,data:n})}else{var k=_.template(f[this.template]);var m=document.getElementById(this.elementId);var l=k(n);m.innerHTML=l;this.bind(m,n)}};var e=function(){var k=this;for(prop in this.events){this.subscribe(prop,this.events[prop])}if(!f[this.template]){if(this.template.substr(0,1)==="#"){f[this.template]=document.getElementById(this.template.substr(1)).innerHTML}else{var l=Happymeal.Port.Adaptor.HTTP.extend({});l.get({url:this.template,callback:function(m){f[this.url]=m.responseText;if(h[this.url]){for(var n=0;n<h[this.url].length;n++){h[this.url][n].view.render(h[this.url][n].data)}h[this.url]=[]}}})}}};var j=function(){};return Happymeal.Mediator.toObject({events:{},render:g,bind:j,initialize:e})}());Happymeal.Model=(function(){return Happymeal.Mediator.toObject({})}());Happymeal.Mediator.extend=Happymeal.Port.Adaptor.HTTP.extend=Happymeal.XMLView.extend=Happymeal.HTMLView.extend=Happymeal.Model.extend=d;Happymeal.Port.Adaptor.Data.XML.Schema.AnyComplexType.extend=d;Happymeal.Port.Adaptor.Data.XML.Schema.AnySimpleType.extend=d}(window));(function(I){I.parser=function(S,T){return new H(S,T)};I.SAXParser=H;I.SAXStream=c;I.createStream=l;I.MAX_BUFFER_LENGTH=64*1024;var B=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];I.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function H(S,T){if(!(this instanceof H)){return new H(S,T)}var U=this;m(U);U.q=U.c="";U.bufferCheckPosition=I.MAX_BUFFER_LENGTH;U.opt=T||{};U.opt.lowercase=U.opt.lowercase||U.opt.lowercasetags;U.looseCase=U.opt.lowercase?"toLowerCase":"toUpperCase";U.tags=[];U.closed=U.closedRoot=U.sawRoot=false;U.tag=U.error=null;U.strict=!!S;U.noscript=!!(S||U.opt.noscript);U.state=j.BEGIN;U.ENTITIES=Object.create(I.ENTITIES);U.attribList=[];if(U.opt.xmlns){U.ns=Object.create(p)}U.trackPosition=U.opt.position!==false;if(U.trackPosition){U.position=U.line=U.column=0}t(U,"onready")}if(!Object.create){Object.create=function(T){function S(){this.__proto__=T}S.prototype=T;return new S}}if(!Object.getPrototypeOf){Object.getPrototypeOf=function(S){return S.__proto__}}if(!Object.keys){Object.keys=function(U){var S=[];for(var T in U){if(U.hasOwnProperty(T)){S.push(T)}}return S}}function r(X){var W=Math.max(I.MAX_BUFFER_LENGTH,10),V=0;for(var U=0,T=B.length;U<T;U++){var S=X[B[U]].length;if(S>W){switch(B[U]){case"textNode":a(X);break;case"cdata":d(X,"oncdata",X.cdata);X.cdata="";break;case"script":d(X,"onscript",X.script);X.script="";break;default:E(X,"Max buffer length exceeded: "+B[U])}}V=Math.max(V,S)}X.bufferCheckPosition=(I.MAX_BUFFER_LENGTH-V)+X.position}function m(U){for(var T=0,S=B.length;T<S;T++){U[B[T]]=""}}function O(S){a(S);if(S.cdata!==""){d(S,"oncdata",S.cdata);S.cdata=""}if(S.script!==""){d(S,"onscript",S.script);S.script=""}}H.prototype={end:function(){v(this)},write:n,resume:function(){this.error=null;return this},close:function(){return this.write(null)},flush:function(){O(this)}};try{var y=require("stream").Stream}catch(J){var y=function(){}}var q=I.EVENTS.filter(function(S){return S!=="error"&&S!=="end"});function l(S,T){return new c(S,T)}function c(S,T){if(!(this instanceof c)){return new c(S,T)}y.apply(this);this._parser=new H(S,T);this.writable=true;this.readable=true;var U=this;this._parser.onend=function(){U.emit("end")};this._parser.onerror=function(V){U.emit("error",V);U._parser.error=null};this._decoder=null;q.forEach(function(V){Object.defineProperty(U,"on"+V,{get:function(){return U._parser["on"+V]},set:function(W){if(!W){U.removeAllListeners(V);return U._parser["on"+V]=W}U.on(V,W)},enumerable:true,configurable:false})})}c.prototype=Object.create(y.prototype,{constructor:{value:c}});c.prototype.write=function(S){if(typeof Buffer==="function"&&typeof Buffer.isBuffer==="function"&&Buffer.isBuffer(S)){if(!this._decoder){var T=require("string_decoder").StringDecoder;this._decoder=new T("utf8")}S=this._decoder.write(S)}this._parser.write(S.toString());this.emit("data",S);return true};c.prototype.end=function(S){if(S&&S.length){this.write(S)}this._parser.end();return true};c.prototype.on=function(U,S){var T=this;if(!T._parser["on"+U]&&q.indexOf(U)!==-1){T._parser["on"+U]=function(){var V=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);V.splice(0,0,U);T.emit.apply(T,V)}}return y.prototype.on.call(T,U,S)};var F="\r\n\t ",R="0124356789",g="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s="'\"",u=R+g+"#",e=F+">",Q="[CDATA[",P="DOCTYPE",o="http://www.w3.org/XML/1998/namespace",x="http://www.w3.org/2000/xmlns/",p={xml:o,xmlns:x};F=z(F);R=z(R);g=z(g);var f=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var K=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;s=z(s);u=z(u);e=z(e);function z(S){return S.split("").reduce(function(T,U){T[U]=true;return T},{})}function h(S){return Object.prototype.toString.call(S)==="[object RegExp]"}function D(S,T){return h(S)?!!T.match(S):S[T]}function L(S,T){return !D(S,T)}var j=0;I.STATE={BEGIN:j++,TEXT:j++,TEXT_ENTITY:j++,OPEN_WAKA:j++,SGML_DECL:j++,SGML_DECL_QUOTED:j++,DOCTYPE:j++,DOCTYPE_QUOTED:j++,DOCTYPE_DTD:j++,DOCTYPE_DTD_QUOTED:j++,COMMENT_STARTING:j++,COMMENT:j++,COMMENT_ENDING:j++,COMMENT_ENDED:j++,CDATA:j++,CDATA_ENDING:j++,CDATA_ENDING_2:j++,PROC_INST:j++,PROC_INST_BODY:j++,PROC_INST_ENDING:j++,OPEN_TAG:j++,OPEN_TAG_SLASH:j++,ATTRIB:j++,ATTRIB_NAME:j++,ATTRIB_NAME_SAW_WHITE:j++,ATTRIB_VALUE:j++,ATTRIB_VALUE_QUOTED:j++,ATTRIB_VALUE_CLOSED:j++,ATTRIB_VALUE_UNQUOTED:j++,ATTRIB_VALUE_ENTITY_Q:j++,ATTRIB_VALUE_ENTITY_U:j++,CLOSE_TAG:j++,CLOSE_TAG_SAW_WHITE:j++,SCRIPT:j++,SCRIPT_ENDING:j++};I.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};Object.keys(I.ENTITIES).forEach(function(S){var U=I.ENTITIES[S];var T=typeof U==="number"?String.fromCharCode(U):U;I.ENTITIES[S]=T});for(var j in I.STATE){I.STATE[I.STATE[j]]=j}j=I.STATE;function t(U,S,T){U[S]&&U[S](T)}function d(U,S,T){if(U.textNode){a(U)}t(U,S,T)}function a(S){S.textNode=b(S.opt,S.textNode);if(S.textNode){t(S,"ontext",S.textNode)}S.textNode=""}function b(S,T){if(S.trim){T=T.trim()}if(S.normalize){T=T.replace(/\s+/g," ")}return T}function E(T,S){a(T);if(T.trackPosition){S+="\nLine: "+T.line+"\nColumn: "+T.column+"\nChar: "+T.c}S=new Error(S);T.error=S;t(T,"onerror",S);return T}function v(S){if(!S.closedRoot){N(S,"Unclosed root tag")}if((S.state!==j.BEGIN)&&(S.state!==j.TEXT)){E(S,"Unexpected end")}a(S);S.c="";S.closed=true;t(S,"onend");H.call(S,S.strict,S.opt);return S}function N(T,S){if(typeof T!=="object"||!(T instanceof H)){throw new Error("bad call to strictFail")}if(T.strict){E(T,S)}}function C(U){if(!U.strict){U.tagName=U.tagName[U.looseCase]()}var T=U.tags[U.tags.length-1]||U,S=U.tag={name:U.tagName,attributes:{}};if(U.opt.xmlns){S.ns=T.ns}U.attribList.length=0}function w(S,W){var U=S.indexOf(":"),V=U<0?["",S]:S.split(":"),X=V[0],T=V[1];if(W&&S==="xmlns"){X="xmlns";T=""}return{prefix:X,local:T}}function A(X){if(!X.strict){X.attribName=X.attribName[X.looseCase]()}if(X.attribList.indexOf(X.attribName)!==-1||X.tag.attributes.hasOwnProperty(X.attribName)){return X.attribName=X.attribValue=""}if(X.opt.xmlns){var V=w(X.attribName,true),W=V.prefix,T=V.local;if(W==="xmlns"){if(T==="xml"&&X.attribValue!==o){N(X,"xml: prefix must be bound to "+o+"\nActual: "+X.attribValue)}else{if(T==="xmlns"&&X.attribValue!==x){N(X,"xmlns: prefix must be bound to "+x+"\nActual: "+X.attribValue)}else{var S=X.tag,U=X.tags[X.tags.length-1]||X;if(S.ns===U.ns){S.ns=Object.create(U.ns)}S.ns[T]=X.attribValue}}}X.attribList.push([X.attribName,X.attribValue])}else{X.tag.attributes[X.attribName]=X.attribValue;d(X,"onattribute",{name:X.attribName,value:X.attribValue})}X.attribName=X.attribValue=""}function k(T,Z){if(T.opt.xmlns){var ag=T.tag;var ae=w(T.tagName);ag.prefix=ae.prefix;ag.local=ae.local;ag.uri=ag.ns[ae.prefix]||"";if(ag.prefix&&!ag.uri){N(T,"Unbound namespace prefix: "+JSON.stringify(T.tagName));ag.uri=ae.prefix}var ad=T.tags[T.tags.length-1]||T;if(ag.ns&&ad.ns!==ag.ns){Object.keys(ag.ns).forEach(function(ah){d(T,"onopennamespace",{prefix:ah,uri:ag.ns[ah]})})}for(var W=0,V=T.attribList.length;W<V;W++){var Y=T.attribList[W];var S=Y[0],ac=Y[1],af=w(S,true),X=af.prefix,aa=af.local,U=X==""?"":(ag.ns[X]||""),ab={name:S,value:ac,prefix:X,local:aa,uri:U};if(X&&X!="xmlns"&&!U){N(T,"Unbound namespace prefix: "+JSON.stringify(X));ab.uri=X}T.tag.attributes[S]=ab;d(T,"onattribute",ab)}T.attribList.length=0}T.tag.isSelfClosing=!!Z;T.sawRoot=true;T.tags.push(T.tag);d(T,"onopentag",T.tag);if(!Z){if(!T.noscript&&T.tagName.toLowerCase()==="script"){T.state=j.SCRIPT}else{T.state=j.TEXT}T.tag=null;T.tagName=""}T.attribName=T.attribValue="";T.attribList.length=0}function M(S){if(!S.tagName){N(S,"Weird empty close tag.");S.textNode+="</>";S.state=j.TEXT;return}if(S.script){if(S.tagName!=="script"){S.script+="</"+S.tagName+">";S.tagName="";S.state=j.SCRIPT;return}d(S,"onscript",S.script);S.script=""}var Z=S.tags.length;var U=S.tagName;if(!S.strict){U=U[S.looseCase]()}var T=U;while(Z--){var Y=S.tags[Z];if(Y.name!==T){N(S,"Unexpected close tag")}else{break}}if(Z<0){N(S,"Unmatched closing tag: "+S.tagName);S.textNode+="</"+S.tagName+">";S.state=j.TEXT;return}S.tagName=U;var aa=S.tags.length;while(aa-->Z){var ab=S.tag=S.tags.pop();S.tagName=S.tag.name;d(S,"onclosetag",S.tagName);var W={};for(var V in ab.ns){W[V]=ab.ns[V]}var X=S.tags[S.tags.length-1]||S;if(S.opt.xmlns&&ab.ns!==X.ns){Object.keys(ab.ns).forEach(function(ac){var ad=ab.ns[ac];d(S,"onclosenamespace",{prefix:ac,uri:ad})})}}if(Z===0){S.closedRoot=true}S.tagName=S.attribValue=S.attribName="";S.attribList.length=0;S.state=j.TEXT}function G(W){var S=W.entity,V=S.toLowerCase(),T,U="";if(W.ENTITIES[S]){return W.ENTITIES[S]}if(W.ENTITIES[V]){return W.ENTITIES[V]}S=V;if(S.charAt(0)==="#"){if(S.charAt(1)==="x"){S=S.slice(2);T=parseInt(S,16);U=T.toString(16)}else{S=S.slice(1);T=parseInt(S,10);U=T.toString(10)}}S=S.replace(/^0+/,"");if(U.toLowerCase()!==S){N(W,"Invalid character entity");return"&"+W.entity+";"}return String.fromCodePoint(T)}function n(T){var Z=this;if(this.error){throw this.error}if(Z.closed){return E(Z,"Cannot write after close. Assign an onready handler.")}if(T===null){return v(Z)}var U=0,Y="";while(Z.c=Y=T.charAt(U++)){if(Z.trackPosition){Z.position++;if(Y==="\n"){Z.line++;Z.column=0}else{Z.column++}}switch(Z.state){case j.BEGIN:if(Y==="<"){Z.state=j.OPEN_WAKA;Z.startTagPosition=Z.position}else{if(L(F,Y)){N(Z,"Non-whitespace before first tag.");Z.textNode=Y;Z.state=j.TEXT}}continue;case j.TEXT:if(Z.sawRoot&&!Z.closedRoot){var W=U-1;while(Y&&Y!=="<"&&Y!=="&"){Y=T.charAt(U++);if(Y&&Z.trackPosition){Z.position++;if(Y==="\n"){Z.line++;Z.column=0}else{Z.column++}}}Z.textNode+=T.substring(W,U-1)}if(Y==="<"){Z.state=j.OPEN_WAKA;Z.startTagPosition=Z.position}else{if(L(F,Y)&&(!Z.sawRoot||Z.closedRoot)){N(Z,"Text data outside of root node.")}if(Y==="&"){Z.state=j.TEXT_ENTITY}else{Z.textNode+=Y}}continue;case j.SCRIPT:if(Y==="<"){Z.state=j.SCRIPT_ENDING}else{Z.script+=Y}continue;case j.SCRIPT_ENDING:if(Y==="/"){Z.state=j.CLOSE_TAG}else{Z.script+="<"+Y;Z.state=j.SCRIPT}continue;case j.OPEN_WAKA:if(Y==="!"){Z.state=j.SGML_DECL;Z.sgmlDecl=""}else{if(D(F,Y)){}else{if(D(f,Y)){Z.state=j.OPEN_TAG;Z.tagName=Y}else{if(Y==="/"){Z.state=j.CLOSE_TAG;Z.tagName=""}else{if(Y==="?"){Z.state=j.PROC_INST;Z.procInstName=Z.procInstBody=""}else{N(Z,"Unencoded <");if(Z.startTagPosition+1<Z.position){var X=Z.position-Z.startTagPosition;Y=new Array(X).join(" ")+Y}Z.textNode+="<"+Y;Z.state=j.TEXT}}}}}continue;case j.SGML_DECL:if((Z.sgmlDecl+Y).toUpperCase()===Q){d(Z,"onopencdata");Z.state=j.CDATA;Z.sgmlDecl="";Z.cdata=""}else{if(Z.sgmlDecl+Y==="--"){Z.state=j.COMMENT;Z.comment="";Z.sgmlDecl=""}else{if((Z.sgmlDecl+Y).toUpperCase()===P){Z.state=j.DOCTYPE;if(Z.doctype||Z.sawRoot){N(Z,"Inappropriately located doctype declaration")}Z.doctype="";Z.sgmlDecl=""}else{if(Y===">"){d(Z,"onsgmldeclaration",Z.sgmlDecl);Z.sgmlDecl="";Z.state=j.TEXT}else{if(D(s,Y)){Z.state=j.SGML_DECL_QUOTED;Z.sgmlDecl+=Y}else{Z.sgmlDecl+=Y}}}}}continue;case j.SGML_DECL_QUOTED:if(Y===Z.q){Z.state=j.SGML_DECL;Z.q=""}Z.sgmlDecl+=Y;continue;case j.DOCTYPE:if(Y===">"){Z.state=j.TEXT;d(Z,"ondoctype",Z.doctype);Z.doctype=true}else{Z.doctype+=Y;if(Y==="["){Z.state=j.DOCTYPE_DTD}else{if(D(s,Y)){Z.state=j.DOCTYPE_QUOTED;Z.q=Y}}}continue;case j.DOCTYPE_QUOTED:Z.doctype+=Y;if(Y===Z.q){Z.q="";Z.state=j.DOCTYPE}continue;case j.DOCTYPE_DTD:Z.doctype+=Y;if(Y==="]"){Z.state=j.DOCTYPE}else{if(D(s,Y)){Z.state=j.DOCTYPE_DTD_QUOTED;Z.q=Y}}continue;case j.DOCTYPE_DTD_QUOTED:Z.doctype+=Y;if(Y===Z.q){Z.state=j.DOCTYPE_DTD;Z.q=""}continue;case j.COMMENT:if(Y==="-"){Z.state=j.COMMENT_ENDING}else{Z.comment+=Y}continue;case j.COMMENT_ENDING:if(Y==="-"){Z.state=j.COMMENT_ENDED;Z.comment=b(Z.opt,Z.comment);if(Z.comment){d(Z,"oncomment",Z.comment)}Z.comment=""}else{Z.comment+="-"+Y;Z.state=j.COMMENT}continue;case j.COMMENT_ENDED:if(Y!==">"){N(Z,"Malformed comment");Z.comment+="--"+Y;Z.state=j.COMMENT}else{Z.state=j.TEXT}continue;case j.CDATA:if(Y==="]"){Z.state=j.CDATA_ENDING}else{Z.cdata+=Y}continue;case j.CDATA_ENDING:if(Y==="]"){Z.state=j.CDATA_ENDING_2}else{Z.cdata+="]"+Y;Z.state=j.CDATA}continue;case j.CDATA_ENDING_2:if(Y===">"){if(Z.cdata){d(Z,"oncdata",Z.cdata)}d(Z,"onclosecdata");Z.cdata="";Z.state=j.TEXT}else{if(Y==="]"){Z.cdata+="]"}else{Z.cdata+="]]"+Y;Z.state=j.CDATA}}continue;case j.PROC_INST:if(Y==="?"){Z.state=j.PROC_INST_ENDING}else{if(D(F,Y)){Z.state=j.PROC_INST_BODY}else{Z.procInstName+=Y}}continue;case j.PROC_INST_BODY:if(!Z.procInstBody&&D(F,Y)){continue}else{if(Y==="?"){Z.state=j.PROC_INST_ENDING}else{Z.procInstBody+=Y}}continue;case j.PROC_INST_ENDING:if(Y===">"){d(Z,"onprocessinginstruction",{name:Z.procInstName,body:Z.procInstBody});Z.procInstName=Z.procInstBody="";Z.state=j.TEXT}else{Z.procInstBody+="?"+Y;Z.state=j.PROC_INST_BODY}continue;case j.OPEN_TAG:if(D(K,Y)){Z.tagName+=Y}else{C(Z);if(Y===">"){k(Z)}else{if(Y==="/"){Z.state=j.OPEN_TAG_SLASH}else{if(L(F,Y)){N(Z,"Invalid character in tag name")}Z.state=j.ATTRIB}}}continue;case j.OPEN_TAG_SLASH:if(Y===">"){k(Z,true);M(Z)}else{N(Z,"Forward-slash in opening tag not followed by >");Z.state=j.ATTRIB}continue;case j.ATTRIB:if(D(F,Y)){continue}else{if(Y===">"){k(Z)}else{if(Y==="/"){Z.state=j.OPEN_TAG_SLASH}else{if(D(f,Y)){Z.attribName=Y;Z.attribValue="";Z.state=j.ATTRIB_NAME}else{N(Z,"Invalid attribute name")}}}}continue;case j.ATTRIB_NAME:if(Y==="="){Z.state=j.ATTRIB_VALUE}else{if(Y===">"){N(Z,"Attribute without value");Z.attribValue=Z.attribName;A(Z);k(Z)}else{if(D(F,Y)){Z.state=j.ATTRIB_NAME_SAW_WHITE}else{if(D(K,Y)){Z.attribName+=Y}else{N(Z,"Invalid attribute name")}}}}continue;case j.ATTRIB_NAME_SAW_WHITE:if(Y==="="){Z.state=j.ATTRIB_VALUE}else{if(D(F,Y)){continue}else{N(Z,"Attribute without value");Z.tag.attributes[Z.attribName]="";Z.attribValue="";d(Z,"onattribute",{name:Z.attribName,value:""});Z.attribName="";if(Y===">"){k(Z)}else{if(D(f,Y)){Z.attribName=Y;Z.state=j.ATTRIB_NAME}else{N(Z,"Invalid attribute name");Z.state=j.ATTRIB}}}}continue;case j.ATTRIB_VALUE:if(D(F,Y)){continue}else{if(D(s,Y)){Z.q=Y;Z.state=j.ATTRIB_VALUE_QUOTED}else{N(Z,"Unquoted attribute value");Z.state=j.ATTRIB_VALUE_UNQUOTED;Z.attribValue=Y}}continue;case j.ATTRIB_VALUE_QUOTED:if(Y!==Z.q){if(Y==="&"){Z.state=j.ATTRIB_VALUE_ENTITY_Q}else{Z.attribValue+=Y}continue}A(Z);Z.q="";Z.state=j.ATTRIB_VALUE_CLOSED;continue;case j.ATTRIB_VALUE_CLOSED:if(D(F,Y)){Z.state=j.ATTRIB}else{if(Y===">"){k(Z)}else{if(Y==="/"){Z.state=j.OPEN_TAG_SLASH}else{if(D(f,Y)){N(Z,"No whitespace between attributes");Z.attribName=Y;Z.attribValue="";Z.state=j.ATTRIB_NAME}else{N(Z,"Invalid attribute name")}}}}continue;case j.ATTRIB_VALUE_UNQUOTED:if(L(e,Y)){if(Y==="&"){Z.state=j.ATTRIB_VALUE_ENTITY_U}else{Z.attribValue+=Y}continue}A(Z);if(Y===">"){k(Z)}else{Z.state=j.ATTRIB}continue;case j.CLOSE_TAG:if(!Z.tagName){if(D(F,Y)){continue}else{if(L(f,Y)){if(Z.script){Z.script+="</"+Y;Z.state=j.SCRIPT}else{N(Z,"Invalid tagname in closing tag.")}}else{Z.tagName=Y}}}else{if(Y===">"){M(Z)}else{if(D(K,Y)){Z.tagName+=Y}else{if(Z.script){Z.script+="</"+Z.tagName;Z.tagName="";Z.state=j.SCRIPT}else{if(L(F,Y)){N(Z,"Invalid tagname in closing tag")}Z.state=j.CLOSE_TAG_SAW_WHITE}}}}continue;case j.CLOSE_TAG_SAW_WHITE:if(D(F,Y)){continue}if(Y===">"){M(Z)}else{N(Z,"Invalid characters in closing tag")}continue;case j.TEXT_ENTITY:case j.ATTRIB_VALUE_ENTITY_Q:case j.ATTRIB_VALUE_ENTITY_U:switch(Z.state){case j.TEXT_ENTITY:var V=j.TEXT,S="textNode";break;case j.ATTRIB_VALUE_ENTITY_Q:var V=j.ATTRIB_VALUE_QUOTED,S="attribValue";break;case j.ATTRIB_VALUE_ENTITY_U:var V=j.ATTRIB_VALUE_UNQUOTED,S="attribValue";break}if(Y===";"){Z[S]+=G(Z);Z.entity="";Z.state=V}else{if(D(u,Y)){Z.entity+=Y}else{N(Z,"Invalid character entity");Z[S]+="&"+Z.entity+Y;Z.entity="";Z.state=V}}continue;default:throw new Error(Z,"Unknown state: "+Z.state)}}if(Z.position>=Z.bufferCheckPosition){r(Z)}return Z}
/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */
;if(!String.fromCodePoint){(function(){var U=String.fromCharCode;var T=Math.floor;var S=function(){var ac=16384;var Y=[];var ab;var aa;var X=-1;var Z=arguments.length;if(!Z){return""}var V="";while(++X<Z){var W=Number(arguments[X]);if(!isFinite(W)||W<0||W>1114111||T(W)!=W){throw RangeError("Invalid code point: "+W)}if(W<=65535){Y.push(W)}else{W-=65536;ab=(W>>10)+55296;aa=(W%1024)+56320;Y.push(ab,aa)}if(X+1==Z||Y.length>ac){V+=U.apply(null,Y);Y.length=0}}return V};if(Object.defineProperty){Object.defineProperty(String,"fromCodePoint",{value:S,configurable:true,writable:true})}else{String.fromCodePoint=S}}())}})(typeof exports==="undefined"?sax={}:exports);